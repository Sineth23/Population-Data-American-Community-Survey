---
title: "Final Project"
author: "Sineth Pathirana"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '3'
  html_notebook:
    df_print: paged
    highlight: tango
    self_contained: yes
    theme: paper
    toc: yes
    toc_depth: 3
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

if (!require("pacman")) {
      install.packages("pacman", dependencies=TRUE, repos='http://cran.rstudio.com/')
      library(pacman)
}

pacman::p_load("tidyverse", "stringr", "babynames", "plotly", "ggplot2", "data.table", "readr", "knitr", "dplyr","ggpubr", "kableExtra","weights" )



```

```{css, echo=FALSE}
.ans {
   background-color:rgb(248,248,248); 
  padding: 1em; 
  border: .1em solid #CCC;
  border-radius:.2em;
  color:purple;
  margin: 1em 0;
}
```


```{r,echo=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(data.table)
library(knitr)
library(plotly)
library(kableExtra)
library(weights)

features <- c("ADJINC", "AGEP", "CIT", "ENG", "SEX", "MAR", "SCHL", "PINCP", "ST", "COW", "RAC2P", "PWGTP", "JWTR")


pusa <- fread("psam_pusa.csv",header = TRUE, select = features, stringsAsFactors = FALSE, data.table = FALSE)
pusb <- fread("psam_pusb.csv",header = TRUE,select = features,stringsAsFactors = FALSE, data.table = FALSE)
pusc <- fread("psam_pusc.csv",header = TRUE, select = features, stringsAsFactors = FALSE, data.table = FALSE)
pusd <- fread("psam_pusd.csv",header = TRUE, select = features, stringsAsFactors = FALSE, data.table = FALSE)

df <- rbind(pusa, pusb, pusc, pusd)
fwrite(df, "usa.csv")
data <- fread("usa.csv",header = TRUE)
```


```{r,echo=FALSE}

names(data) <- c("Adjustment", "Age", "Citizenship", "English", "Sex", "Marital_Status", "Education", "Income", "State", "Class_of_Worker","Race","PWGTP", "Transportation" )

data$Sex <- factor(data$Sex, levels = c(1,2), labels = c("Male", "Female"))


data$Citizenship <-factor(data$Citizenship, levels = c(1,2,3,4,5), labels = c("Born in the U.S.", "Born in Puerto Rico, Guam, the U.S. Virgin Islands, or the
.Northern Marianas", "Born abroad of American parent(s)", "U.S. citizen by naturalization", "Not a citizen of the U.S."))

data$Class_of_Worker <- factor(data$Class_of_Worker, levels = c(0,1,2,3,4,5,6,7,8,9), labels = c("Not in universe less than 16 years old/NILF who last worked more than 5 years ago or never worked", "Employee of a private for-profit company or business, or of an individual, for wages, salary, or commissions", "Employee of a private not-for-profit, tax-exempt, or charitable organization", "Local government employee (city, county, etc.)", "State government employee", "Federal government employee", "Self-employed in own not incorporated business, professional practice, or farm", "Self-employed in own incorporated business, professional practice or farm", "Working without pay in family business or farm", "Unemployed and last worked 5 years ago or earlier or never worked"))

data$Education <- factor(data$Education, levels = c(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24), labels = c("less than 3 years old",
                    "No schooling completed",
                    "Nursery school preschool", 
                    "Kindergarten",
                    "Grade 1", 
                    "Grade 2", 
                    "Grade 3", 
                    "Grade 4", 
                    "Grade 5", 
                    "Grade 6", 
                    "Grade 7", 
                    "Grade 8", 
                    "Grade 9",
                    "Grade 10",
                    "Grade 11",
                    "12th grade - no diploma",
                    "Regular high school diploma",
                    "GED or alternative credential", 
                    "Some college, but less than 1 year", 
                    "1 or more years of college credit no degree",
                    "Associate's degree", 
                    "Bachelor's degree", 
                    "Master's degree", 
                    "Professional degree beyond a bachelor's degree", "Doctorate degree"))


data$Transportation <- factor(data$Transportation, levels =c(0,1,2,3,4,5,6,7,8,9,10,11,12),  labels = c("N/A (not a worker--not in the labor force, including persons .under 16 years; unemployed; employed, with a job but not at .work; Armed Forces, with a job but not at work","Car, truck, or van","Bus or trolley bus","Streetcar or trolley car (carro publico in Puerto Rico)","Subway or elevated","Railroad","Ferryboat","Taxicab","Motorcycle","Bicycle","Walked","Worked at home","Other method"))

data$Marital_Status <- factor(data$Marital_Status, levels = c(1,2,3,4,5), labels = c("Married", "Widowed", "Divorced","Separated", "Never married or under 15 years old"))

data$English <- factor(data$English, levels =c(0,1,2,3,4),  labels = c("N/A (less than 5 years old/speaks only English)","Very well","Well","Not well","Not at all"))


data$State <- factor(data$State, levels = c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51), labels = c("alabama","arizona","arkansas","california","colorado","connecticut","delaware","district of columbia","florida","georgia","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts","michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","new hampshire","new jersey","new mexico","new york","north carolina","north dakota","ohio","oklahoma","oregon","pennsylvania","rhode island","south carolina","south" ,"dakota",
"tennessee","texas","utah","vermont","virginia","washington","west virginia","wisconsin","wyoming","puerto rico"))



data$Race <- factor(data$Race, levels = c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68), labels = c("White alone","Black or African American alone","Apache alone","Blackfeet alone","Cherokee alone","Cheyenne alone","Chickasaw alone","Chippewa alone","Choctaw alone","Comanche alone","Creek alone","Crow alone","Hopi alone","Iroquois alone","Lumbee alone","Mexican American Indian alone","Navajo alone","Pima alone","Potawatomi alone","Pueblo alone","Puget Sound Salish alone","Seminole alone","Sioux alone","South American Indian alone","Tohono O'Odham alone","Yaqui alone","Other specified American Indian tribes alone","All other specified American Indian tribe combinations","American Indian, tribe not specified","Alaskan Athabascan alone","Tlingit-Haida alone","Inupiat alone","Yup'ik alone","Aleut alone","Other Alaska Native","Other American Indian and Alaska Native specified","American Indian and Alaska Native, not specified","Asian Indian alone","Bangladeshi alone","Bhutanese alone","Burmese alone","Cambodian alone","Chinese, except Taiwanese, alone","Taiwanese alone","Filipino alone","Hmong alone","Indonesian alone","Japanese alone","Korean alone","Laotian alone","Malaysian alone","Mongolian alone","Nepalese alone","Pakistani alone","Sri Lankan alone","Thai alone","Vietnamese alone","Other Asian alone","All combinations of Asian races only","Native Hawaiian alone","Samoan alone","Tongan alone","Guamanian or Chamorro alone","Marshallese alone","Fijian alone","Other Native Hawaiian and Other Pacific Islander","Some Other Race alone","Two or More Races"))



data <- data %>%
  mutate(Age_category = factor(case_when(Age < 15 ~ "Child", Age >= 15 & Age <= 24 ~ "Youth", Age >= 25 & Age <= 64 ~ "Adult", Age >= 65 ~ "Senior")),
         Income = Income * (Adjustment/1000000))





```


## 1. Data Summary

The data of this analysis was obtained from the Public Use Microdata Sample (PUMS) files. The Public Use Microdata Sample files contain a plethora of user defined characteristics. All of the files consist of a sample of responses to the American Community Survey (ACS) between 2014-2018.  Variables for the majority of the questions on the ACS survey, are included in the PUMS files.  The PUMS files are divided into two categories of population and household characteristics. I decided to perform my analysis on population data. 

The population data represents a single person, while in the household data the individuals are separated into households. The PUMS files reporting a 5-year period, resembles 5% of the population.  For confidentiality purposes, some of the variables such as income are disguised with codes or broad categories. Similarly, there are only a limited number of geographic levels available in the PUMS files, such as region, regional division, state and Public Use Microdata Area (PUMA).  The PUMS Data Dictionary included with the files encompass s PUMS variables, their values and the meaning of each of the values listed. After careful examination of the Data Dictionary, I selected 12 variables in my analysis.  The variables that I used in the analysis are "ADJINC", "AGEP", "CIT", "ENG", "SEX", "MAR", "SCHL", "PINCP", "ST", "LANP", "COW", "RAC2P", "JWTR", “PWGTP” and "Transportation".

First, I uploaded the 4 datasets into the r using the fread() function. Using rbind(), I merged all the datasets and created another new csv file named data.csv using the fwirte function.	To better understand the data, I renamed the variables to "Adjustment", "Age", "Citizenship", "English", "Sex", "Marital_Status", "Education", "Income", "Race_1", "State", "Language", "Class_of_Worker","Race" and “PWGTP”.  The next important task is to clean the data using the factor function.  The variables that underwent through the factor() function are ", "Citizenship", "English", "Sex", "Marital_Status", "Education", "Race", "State", "Language", "Class _of_Worker","Race_2". 

The variable “Sex” was factored into 2 levels, with the labels; "Male", "Female". 

The variable “English” is factored into 5 levels, with the labels; "N/A (less than 5 years old/speaks only English)","Very well","Well","Not well","Not at all". The variable “Citizenship” was factored into 5 levels, with the labels; "Born in the U.S.", "Born in Puerto Rico, Guam, the U.S. Virgin Islands, or the Northern Marianas", "Born abroad of American parent(s)", "U.S. citizen by naturalization", "Not a citizen of the U.S.".

The variable “Marital_Status” was factored into 2 levels, with the labels; "Married", "Widowed", "Divorced","Separated", "Never married or under 15 years old".

The variable “Class_of_Worker” was factored into 10 levels, with the labels; "Not in universe less than 16 years old/NILF who last worked more than 5 years ago or never worked", "Employee of a private for-profit company or business, or of an individual, for wages, salary, or commissions", "Employee of a private not-for-profit, tax-exempt, or charitable organization", "Local government employee (city, county, etc.)", "State government employee", "Federal government employee", "Self-employed in own not incorporated business, professional practice, or farm", "Self-employed in own incorporated business, professional practice or farm", "Working without pay in family business or farm", "Unemployed and last worked 5 years ago or earlier or never worked".  

The variable “Education” was factored into 25 levels , with the labels; "less than 3 years old”, “No schooling completed", "Nursery school preschool", "Kindergarten", "Grade 1","Grade 2","Grade 3","Grade 4","Grade 5","Grade 6","Grade 7","Grade 8","Grade 9","Grade 10","Grade 11","12th grade - no diploma", "Regular high school diploma", "GED or alternative credential", "Some college, but less than 1 year","1 or more years of college credit no degree", "Associate's degree", "Bachelor's degree", "Master's degree", "Professional degree beyond a bachelor's degree", "Doctorate degree".

The variable “State” was factored into 51 levels , with the labels; "alabama","arizona","arkansas","california","colorado","connecticut","delaware","district of columbia","florida","georgia","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts", "michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","new hampshire","new jersey","new mexico","new york","north carolina","north dakota","ohio","oklahoma","oregon","pennsylvania","rhode island","south carolina","south" ,"dakota","tennessee","texas","utah","vermont","virginia","washington","west virginia","wisconsin","wyoming","puerto rico”.

The variable “Race” was factored into 68 levels, with the labels;  "White alone","Black or African American alone","Apache alone","Blackfeet alone","Cherokee alone","Cheyenne alone","Chickasaw alone","Chippewa alone","Choctaw alone","Comanche alone","Creek alone","Crow alone","Hopi alone","Iroquois alone","Lumbee alone","Mexican American Indian alone","Navajo alone","Pima alone","Potawatomi alone","Pueblo alone","Puget Sound Salish alone","Seminole alone","Sioux alone","South American Indian alone","Tohono O'Odham alone","Yaqui alone","Other specified American Indian tribes alone","All other specified American Indian tribe combinations","American Indian, tribe not specified","Alaskan Athabascan alone","Tlingit-Haida alone","Inupiat alone","Yup'ik alone","Aleut alone","Other Alaska Native","Other American Indian and Alaska Native specified","American Indian and Alaska Native, not specified","Asian Indian alone","Bangladeshi alone","Bhutanese alone","Burmese alone","Cambodian alone","Chinese, except Taiwanese, alone","Taiwanese alone","Filipino alone","Hmong alone","Indonesian alone","Japanese alone","Korean alone","Laotian alone","Malaysian alone","Mongolian alone","Nepalese alone","Pakistani alone","Sri Lankan alone","Thai alone","Vietnamese alone","Other Asian alone","All combinations of Asian races only","Native Hawaiian alone","Samoan alone","Tongan alone","Guamanian or Chamorro alone","Marshallese alone","Fijian alone","Other Native Hawaiian and Other Pacific Islander","Some Other Race alone","Two or More Races"

The variable “Transportation” was factored into 13 levels, with the labels: "N/A (not a worker--not in the labor force, including persons .under 16 years; unemployed; employed, with a job but not at .work; Armed Forces, with a job but not at work","Car, truck, or van","Bus or trolley bus","Streetcar or trolley car (carro publico in Puerto Rico)","Subway or elevated","Railroad","Ferryboat","Taxicab","Motorcycle","Bicycle","Walked","Worked at home","Other method".



```{r,echo=FALSE}
data %>%
  ggplot(aes(x=Income, weight=sum(PWGTP)))+
  geom_histogram(color="darkblue", fill="lightblue") +
 labs(title="Income Distribution",x="Income", y = "Count")+
  theme_classic()

```


```{r, echo=FALSE}

plot_ly(type = "box",
              y = ~Income,
              data = data,
              name = "All income") %>% 
  layout(title = "Overall income",
         xaxis = list(title = "",
                      zeroline = FALSE),
         yaxis = list(title = "Income",
                      zeroline = FALSE))

```


The histogram plot displayed on the Income variables, shows a positive skewed distribution. The boxplot on Income indicates that the majority of the population are in the income between $ 0-89.3k. The outliers of this boxplot go from the upper fence to $732.3k.


```{r,echo=FALSE}
data %>%
  ggplot(aes(x=Age, color=Sex, fill=Sex, weights = sum(PWGTP))) +
  geom_histogram(aes(y=..density..), position="dodge", alpha=0.5)+
  geom_density(alpha=0.1)+
  scale_color_manual(values=c("#0040ff", "#E69F00", "#56B4E9"))+
  scale_fill_manual(values=c("#0040ff", "#E69F00", "#56B4E9"))+
  labs(title="Age and Sex Distribution",x="Age", y = "Count")+
  theme_classic()

```


The visualization shown above is a histogram plot of age distribution with sex. Both males and females follow a similar pattern of distribution.even though the total number of females is greater.  The density curves show a bi-modal pattern for both males and females. The total number of females seems to increase approximately from 60 years and onward. 





```{r,echo=FALSE}
data %>%
group_by(Citizenship) %>%
summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
ggplot(aes(x="", y=Count, fill=Citizenship)) + geom_bar(stat = "identity", width = 6) +coord_polar("y", start=0) + scale_fill_brewer(palette="Dark2") + theme(axis.text.x = element_blank(),axis.ticks.x = element_blank()) 

```

Based on the pie chart displaced above, the majority of the people in this dataset are born in the U.S. There is a similar proportion of individuals born in Puerto Rico, Guam, the U.S. Virgin Islands, Northern Marianas to individuals born abroad of American parents.


```{r,echo=FALSE}
data %>%
group_by(Marital_Status) %>%
summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
ggplot(aes(x=Marital_Status, y=Count, fill=Marital_Status)) + geom_bar(stat = "identity", width=0.7, position=position_dodge(width=10)) + scale_fill_manual(values=c("#999999", "#E69F00", "white","#E69F00", "#56B4E9" )) + labs(title="Distribution of People by Marital Status", x="Marital Status", y = "Count") + theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) 

```


A bar plot on marital status indicates that the majority of the people fall under the categories of “Married” and “Never married or under 15 years old. Small proportion of people fall under “Widowed”, “Divorced”, “Seperated”, relative to the aforementioned categories. 


```{r,echo=FALSE}
data %>%
group_by(Race) %>%
summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
top_n(20) %>%
ggplot(aes(x=Race, y=Count)) + 
  geom_point(col="tomato2", size=5) +   
  geom_segment(aes(x=Race, 
                   xend=Race, 
                   y=min(Count), 
                   yend=max(Count)), 
               linetype="dashed", 
               size=0.1) +   
  labs(title="Distribution of People by Ethnicity") +  
  coord_flip() + theme_classic()
```



Since the race variable contains 68  different races, I decided to create a plot that contains only the top 20 most popular races in the dataset. There are a large number of individuals under the race category of “White alone”, followed by “Black or African American alone”. The rest of the minorities in the top 20, appear to have similar proportions. 


```{r,echo=FALSE}

data %>%
  select(Age_category, English, PWGTP) %>%
  group_by(Age_category, English) %>%
  
  summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(x=Age_category, y=Count, fill=English)) + geom_bar(stat = "identity", width=0.7, position = "dodge") + labs(title="English Fluency", x="Age Group", y = "Count") + theme_classic() + coord_flip()
```


Bar plot diagram on English Language fluency highlights that there is an abundance of individuals in the N/A category. This N/A category represents native speakers who only speak English. However, there are only a small number of individuals who are not proficient in English speaking. 


```{r,echo=FALSE}
kable(data %>%
  group_by(Class_of_Worker) %>%
  summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
  na.omit() %>%
  arrange(desc(Count)))  %>%
  kable_classic_2()

```


The table displayed above captures the number of individuals from each class of work. Most people are employees of a private for profit or business, or of an individual for wages, salary, or commissions. People who work without pay are in family business or farm accounts for the smallest work class category.


```{r,echo=FALSE}
data %>%
group_by(Transportation) %>%
summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(Transportation, Count, fill=Transportation, color=Transportation)) + geom_count(show.legend = F) + 
    labs(y="Count") + theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) + coord_flip() + theme_classic()
```


The figure presented above shows the count of people with their corresponding means of transportation. Most number of people fall under N/A (not a worker--not in the labor force, including persons under 16 years; unemployed; employed, with a job but not at work; Armed Forces, with a job but not at work. The next most popular means of transportation is via car, truck or van. All the other means of transportation are distributed relatively the same. 


```{r,echo=FALSE}
kable(data %>%
  group_by(Education) %>%
  summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
  na.omit() %>%
  arrange(desc(Count)))  %>%
  kable_classic_2()
```


The table illustrates the education backgrounds of all individuals in the dataset. Most of the individuals have regular high school diplomas followed by some college, but less than 1 year and bachelor’s degrees. The least number of people are under doctorate degree education category. 


```{r,echo=FALSE}
data %>%
  count(State, sort = TRUE, weight = sum(PWGTP)) %>%
  mutate(State = reorder(State,n)) %>%
  na.omit() %>%
  ggplot(aes(x = State,y = n, fill=State)) +
  geom_col(show.legend = F) +
  coord_flip() +
      labs(x = "State",
      y = "Count",
      title = "The Distributions of Peopl by State")

```



The population distribution bar plot displayed above reveals that Connecticut, West Virginia and Illinoi are the top 3 most popular states in this dataset.  The bottom 3 states of population distribution are Wyoming, Idaho, and Arizona. 

## 2. Methodology

After conducting data visualizations and exploration, I decided to inspect each variable with respect to the Income variable. The variables that I chose for analysis are Education, Sex, English (English Language Proficiency), State, Class of Work, Race, Age and Transportation. I decided not to normalize the outliers of the Income variable, as it may be insightful for analysis with the selected variables. The missing values of all variables are removed with dplyr functions.The income variable is adjusted accordingly with the inflation rate (ADJIN). I adjsted the income variable by dividing the income by 1,000,000 and multiplying by the ADJIN column. The weight feature (PWGTP) is included in all the graphs and tabulations.

The variable Education is inspected first to see if the type of education has an impact on the income of an individual. To further assess this, I conducted a statistical analysis incorporating ANOVA. I also conducted a linear regression to investigate whether there is a linear relationship between Education and Income. 

The second variable of interest is Sex. I first visualized the distribution of Income with Sex using a histogram plot.  Then I conducted a statistical t-test to discern if there is a significant difference between a person Sex commensurate to Income.

Based on the visualization on English Fluency in the previous section, most people are observed to only speak English (native speakers) or children younger than 5 years old. Therefore, I decided to filter out the NA (native speakers) category to look at the variable of Income among people who speak English as a second language. 

The Class of Work variable was another important variable that I inspected using a bar plot. Then I conducted a statistical test with ANOVA to corroborate the visualization. 

Furthermore, I created more visualizations and tabulations on variables such as Transportation, Marital Status, Race, and Citizenship to depict patterns with the Income variable.

Lastly I conducted a Multiple Regression Model to have an overall picture of selected variables in their prediction of Income. The variables selected for the multiple regression are Education, Class of Worker, Sex and Marital Status. 

## 3. Findings



```{r,echo=FALSE}
kable(data %>%
  group_by(Education) %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
  arrange(desc(Average.Income))%>%
  top_n(5)) %>%
  kable_classic_2()
```


The table above displays the average Income of top 5 educational backgrounds in the dataset.  The highest average income is seen among individuals who completed a professional degree beyond a bachelor’s degree followed by individuals with doctorate and master’s degrees.


```{r,echo=FALSE}
ed.anova <- aov(Income~Education, data = data, weights = PWGTP)
summary(ed.anova)
```


The summary of the One-Way ANOVA  on Education Backgrounds and Income presents a p-value less than all the significant levels. Thereby, we can deduce that there are significant differences between the Education backgrounds for the outcome of Income.


```{r,echo=FALSE}
model <- lm(Income~Education, data = data, weights = PWGTP)
summary(model)
```


The linear model constructed on Education Background vs. Income produces a p-value less than 0.05. This concludes that there is a relationship between a person’s education and their income. All the coefficients in this linear are significant except the Education Grade 6 variable. The adjusted R-squared value is  0.1682. This implies that roughly 17% of the variance found in the response variable of Income can be explained by the predictor variable (Education). The F-statistic value of this model is also below the 0.05 significance, confirming the relationship between the predictor and the outcome variable.    




```{r,echo=FALSE}
data %>%
  ggplot(aes(x=Income, color=Sex, fill=Sex, weights = sum(PWGTP))) +
  geom_histogram() + labs(title="Income Distribution",x="Income", y = "Count")
```



The histogram plot on Income appears to be positively skewed for both males and females. However, the count of males in high income categories seem to be greater than females. 


```{r,echo=FALSE}
wtd.t.test(x=data$Income[data$Sex=="Male"],y=data$Income[data$Sex=="Female"], weight = data$PWGTP[data$Sex=="Male"], weighty = data$PWGTP[data$Sex=="Female"])
```


The p-value of the t-test generated above is below the significance level of 0.05. This suggests that the mean income of males and females are significantly different. 


```{r,echo=FALSE}

data %>%
  group_by(English, Sex) %>%
  filter(English != "NA") %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(English, Average.Income, fill = Sex)) + geom_bar(stat="identity", position = "dodge")+scale_fill_brewer(palette="Paired") + theme_minimal() + labs(title="Income Distribution",x="Income", y = "Count")

```




The bar plot above illustrates that the level of English Fluency  has an impact on the Average Income of ethnic individuals who reside in the United States of America. The Average Income of both males and females follow an upward trend from the English fluency level of “Not at all” to “Very Well”. 


```{r,echo=FALSE}
kable(data %>%
  group_by(Transportation) %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE),
            count = sum(PWGTP)) %>%
  mutate(Transportation = reorder(Transportation, Average.Income)) %>%
  arrange(desc(Average.Income))) %>% kable_classic_2()

```

The transportation means of individuals in this dataset seems to indicate interesting results in the table presented above. The top 3 Average Income falls  under the transportation means of ferryboat, railroad and subway. The lowest Average Income is observed in the NA category or not a worker, not in the labor force, including persons under 16 years; unemployed; employed, with a job but not at work; Armed Forces, with a job but not at work.



```{r,echo=FALSE}

kable(data %>%
  group_by(Race) %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
  mutate(Race = reorder(Race, Average.Income)) %>%
  arrange(desc(Average.Income)) %>%
  top_n(10)) %>% kable_classic_2()
```



```{r,echo=FALSE}
data %>%
  group_by(Race,Sex) %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(x=Race, y=Average.Income, fill = Sex)) + geom_col() + theme(axis.text.x = element_blank(),axis.ticks.x = element_blank()) + labs(title="Average Income of All Races",x="Race", y = "Average Income") 

```



The tabulated data displayed above looks at the top 10 races with highest average income values. The highest average income is seen among Asian Indian individuals followed by Taiwanaese, Japanese etc. But it appears as though females earn significantly less than males in the bar plot on Race and Average Income. 


```{r,echo=FALSE}
kable(data %>%
  group_by(Class_of_Worker) %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE),
            count = sum(PWGTP)) %>%
  mutate(Class_of_Worker = reorder(Class_of_Worker, Average.Income)) %>%
  arrange(desc(Average.Income))) %>% kable_classic_2()
```


The Class of the Worker can play an important role in the prediction of Average Income. According to the tabulated data displayed above, the highest Average Income is recorded by individuals who are self-employed in their own incorporated business, profession practice or farm followed by federal government employees. The lowest Average Income is observed among people who are unemployed and last worked 5 years ago or earlier or never worked. 



```{r,echo=FALSE}
cl_anova <- aov(Income~Class_of_Worker, data = data, weights = PWGTP)
summary(cl_anova)
```


The summary of the One-Way ANOVA on Class of Worker and Income presents a p-value less than all the significant levels. Thereby, we can conclude that there are significant differences between the Class of Worker for the outcome of Income.



```{r,echo=FALSE}
data %>%
  group_by(Marital_Status, Sex) %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(Marital_Status, Average.Income, fill = Sex)) + geom_bar(stat="identity", position = "dodge")+scale_fill_brewer(palette="Greens") + theme_minimal() + coord_flip() + labs(title="Average Income by Marital Status",x="Marital Status", y = "Average Income")
```


The Marital Status of people in this dataset also indicates a pattern with the Average Income. The Average Income of Married people are greater than people who are widowed, divorced, separated and never married or under 15 years old.


```{r,echo=FALSE}
citlabs <- c("U.S.Born", "Born in Puerto Rico ..", "Born abroad of American parent(s)", "U.S. citizen by naturalization", "Not U.S citizen")


data %>%
  group_by(Citizenship, Sex) %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(Citizenship, Average.Income, fill = Sex)) + geom_bar(stat="identity", position = "dodge")+scale_fill_brewer(palette="Reds") + theme_minimal() + scale_x_discrete(labels= citlabs) + coord_flip() + labs(title="Average Income by Citizenship",x="Citizenship", y = "Average Income")

```



Intersigly, individuals who are U.S. citizens by naturalization outperform U.S. born citizens and individuals born abroad to American parents, in terms of average income.










```{r, echo=FALSE}
model.m <- lm(Income~Education + Class_of_Worker + Sex + Marital_Status, data = data, weights = PWGTP)
summary(model.m)
```


The results of the multiple regression on Education, Class of Worker, Sex and Marital Status produce a p-value less than the 0.05 significant level. Almost all the coefficients in this model show significance. The Adjusted R-squared is 0.2256, meaning approximately 22.5% of the variance found in the response variable of Income can be explained by the predictor variables Education, Class of Worker, Sex and Marital Status. The F-statistic number is significantly greater than 1, indicating that there is a relationship between the predictor and response variables. 




## 4. Discussion

Overall, the variables utilized in this dataset have been useful in predicting the outcome of Income. The visualization plots and tabulations created with the variables; Education, Class of Work, Marital Status, Age, Means of Transportation, Race, English Fluency, Citizenship and Sex were impertative in uncovering patterns of income in United States of America. Majority of the visualizations in all categories distinguish that the average income of women is significantly lower. Furthermore, it was evident that people from different races(minorities) in the U.S.A. have higher likelihood of earning more income. Another interesting finding was that people who travel via ferry boat, railroad and subway in this dataset have the highest average income.

I conducted multiple statistical tests to gain some insight on some key variables that I anticipated to predict the Income variable: ANOVA, linear regression, t-test and multiple regression. The ANOVA test on Education and Income generated significant results implying that higher education plays an important role in one’s income. The second ANOVA test on Class of Worker and Income also produced significant results. This was deemed to be a good indicator of income. The weighted t-test on sex and income shed some light on the fact that income of males are significantly higher than males. 

This data analysis is limited by the fact it only contains few features from the original dataset due to hardware constraints. With given hardware specification, this analysis can be enhanced by adding more features. Another limitation of this analysis is that I only focused on detecting general patterns of variables, rather than allocating more attention on specifics. For future direction, this analysis can be bolstered with incorporation of machine learning and other validation techniques such as RMSE etc. The Adjusted R-squared values may increase, if the Income variable is transformed with log functions along with the addition of more variables.


## Appendix 


```{r, eval=F, echo=T}
library(readr)
library(dplyr)
library(ggplot2)
library(data.table)
library(knitr)
library(plotly)

features <- c("ADJINC", "AGEP", "CIT", "ENG", "SEX", "MAR", "SCHL", "PINCP", "ST", "COW", "RAC2P", "PWGTP", "JWTR")


pusa <- fread("psam_pusa.csv",header = TRUE, select = features, stringsAsFactors = FALSE, data.table = FALSE)
pusb <- fread("psam_pusb.csv",header = TRUE,select = features,stringsAsFactors = FALSE, data.table = FALSE)
pusc <- fread("psam_pusc.csv",header = TRUE, select = features, stringsAsFactors = FALSE, data.table = FALSE)
pusd <- fread("psam_pusd.csv",header = TRUE, select = features, stringsAsFactors = FALSE, data.table = FALSE)

df <- rbind(pusa, pusb, pusc, pusd)
fwrite(df, "usa.csv")
data <- fread("usa.csv",header = TRUE)


names(data) <- c("Adjustment", "Age", "Citizenship", "English", "Sex", "Marital_Status", "Education", "Income", "State", "Class_of_Worker","Race","PWGTP", "Transportation" )

data$Sex <- factor(data$Sex, levels = c(1,2), labels = c("Male", "Female"))


data$Citizenship <-factor(data$Citizenship, levels = c(1,2,3,4,5), labels = c("Born in the U.S.", "Born in Puerto Rico, Guam, the U.S. Virgin Islands, or the
.Northern Marianas", "Born abroad of American parent(s)", "U.S. citizen by naturalization", "Not a citizen of the U.S."))

data$Class_of_Worker <- factor(data$Class_of_Worker, levels = c(0,1,2,3,4,5,6,7,8,9), labels = c("Not in universe less than 16 years old/NILF who last worked more than 5 years ago or never worked", "Employee of a private for-profit company or business, or of an individual, for wages, salary, or commissions", "Employee of a private not-for-profit, tax-exempt, or charitable organization", "Local government employee (city, county, etc.)", "State government employee", "Federal government employee", "Self-employed in own not incorporated business, professional practice, or farm", "Self-employed in own incorporated business, professional practice or farm", "Working without pay in family business or farm", "Unemployed and last worked 5 years ago or earlier or never worked"))

data$Education <- factor(data$Education, levels = c(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24), labels = c("less than 3 years old",
                    "No schooling completed",
                    "Nursery school preschool", 
                    "Kindergarten",
                    "Grade 1", 
                    "Grade 2", 
                    "Grade 3", 
                    "Grade 4", 
                    "Grade 5", 
                    "Grade 6", 
                    "Grade 7", 
                    "Grade 8", 
                    "Grade 9",
                    "Grade 10",
                    "Grade 11",
                    "12th grade - no diploma",
                    "Regular high school diploma",
                    "GED or alternative credential", 
                    "Some college, but less than 1 year", 
                    "1 or more years of college credit no degree",
                    "Associate's degree", 
                    "Bachelor's degree", 
                    "Master's degree", 
                    "Professional degree beyond a bachelor's degree", "Doctorate degree"))


data$Transportation <- factor(data$Transportation, levels =c(0,1,2,3,4,5,6,7,8,9,10,11,12),  labels = c("N/A (not a worker--not in the labor force, including persons .under 16 years; unemployed; employed, with a job but not at .work; Armed Forces, with a job but not at work","Car, truck, or van","Bus or trolley bus","Streetcar or trolley car (carro publico in Puerto Rico)","Subway or elevated","Railroad","Ferryboat","Taxicab","Motorcycle","Bicycle","Walked","Worked at home","Other method"))

data$Marital_Status <- factor(data$Marital_Status, levels = c(1,2,3,4,5), labels = c("Married", "Widowed", "Divorced","Separated", "Never married or under 15 years old"))

data$English <- factor(data$English, levels =c(0,1,2,3,4),  labels = c("N/A (less than 5 years old/speaks only English)","Very well","Well","Not well","Not at all"))


data$State <- factor(data$State, levels = c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51), labels = c("alabama","arizona","arkansas","california","colorado","connecticut","delaware","district of columbia","florida","georgia","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts","michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","new hampshire","new jersey","new mexico","new york","north carolina","north dakota","ohio","oklahoma","oregon","pennsylvania","rhode island","south carolina","south" ,"dakota",
"tennessee","texas","utah","vermont","virginia","washington","west virginia","wisconsin","wyoming","puerto rico"))



data$Race <- factor(data$Race, levels = c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68), labels = c("White alone","Black or African American alone","Apache alone","Blackfeet alone","Cherokee alone","Cheyenne alone","Chickasaw alone","Chippewa alone","Choctaw alone","Comanche alone","Creek alone","Crow alone","Hopi alone","Iroquois alone","Lumbee alone","Mexican American Indian alone","Navajo alone","Pima alone","Potawatomi alone","Pueblo alone","Puget Sound Salish alone","Seminole alone","Sioux alone","South American Indian alone","Tohono O'Odham alone","Yaqui alone","Other specified American Indian tribes alone","All other specified American Indian tribe combinations","American Indian, tribe not specified","Alaskan Athabascan alone","Tlingit-Haida alone","Inupiat alone","Yup'ik alone","Aleut alone","Other Alaska Native","Other American Indian and Alaska Native specified","American Indian and Alaska Native, not specified","Asian Indian alone","Bangladeshi alone","Bhutanese alone","Burmese alone","Cambodian alone","Chinese, except Taiwanese, alone","Taiwanese alone","Filipino alone","Hmong alone","Indonesian alone","Japanese alone","Korean alone","Laotian alone","Malaysian alone","Mongolian alone","Nepalese alone","Pakistani alone","Sri Lankan alone","Thai alone","Vietnamese alone","Other Asian alone","All combinations of Asian races only","Native Hawaiian alone","Samoan alone","Tongan alone","Guamanian or Chamorro alone","Marshallese alone","Fijian alone","Other Native Hawaiian and Other Pacific Islander","Some Other Race alone","Two or More Races"))



data <- data %>%
  mutate(Age_category = factor(case_when(Age < 15 ~ "Child", Age >= 15 & Age <= 24 ~ "Youth", Age >= 25 & Age <= 64 ~ "Adult", Age >= 65 ~ "Senior")),
         Income = Income * (Adjustment/1000000))



```


```{r,  eval=F, echo=T}
data %>%
  ggplot(aes(x=Income, weight=sum(PWGTP)))+
  geom_histogram(color="darkblue", fill="lightblue") +
  labs(title="Income Distribution",x="Income", y = "Count")+
  theme_classic()

plot_ly(type = "box",
        y = ~Income,
        data = data,
        name = "All income") %>% 
  layout(title = "Overall income",
         xaxis = list(title = "",
                      zeroline = FALSE),
         yaxis = list(title = "Income",
                      zeroline = FALSE))

data %>%
  ggplot(aes(x=Age, color=Sex, fill=Sex, weights = sum(PWGTP))) +
  geom_histogram(aes(y=..density..), position="dodge", alpha=0.5)+
  geom_density(alpha=0.1)+
  scale_color_manual(values=c("#0040ff", "#E69F00", "#56B4E9"))+
  scale_fill_manual(values=c("#0040ff", "#E69F00", "#56B4E9"))+
  labs(title="Age and Sex Distribution",x="Age", y = "Count")+
  theme_classic()


data %>%
  group_by(Citizenship) %>%
  summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(x="", y=Count, fill=Citizenship)) + geom_bar(stat = "identity", width = 6) +coord_polar("y", start=0) + scale_fill_brewer(palette="Dark2") + theme(axis.text.x = element_blank(),axis.ticks.x = element_blank()) 



data %>%
  group_by(Marital_Status) %>%
  summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(x=Marital_Status, y=Count, fill=Marital_Status)) + geom_bar(stat = "identity", width=0.7, position=position_dodge(width=10)) + scale_fill_manual(values=c("#999999", "#E69F00", "white","#E69F00", "#56B4E9" )) + labs(title="Distribution of People by Marital Status", x="Marital Status", y = "Count") + theme(axis.text.x = element_blank(),
                                                                                                                                                                                                                                                                                                                               axis.ticks.x = element_blank()) 


data %>%
  group_by(Race) %>%
  summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
  top_n(20) %>%
  ggplot(aes(x=Race, y=Count)) + 
  geom_point(col="tomato2", size=5) +   
  geom_segment(aes(x=Race, 
                   xend=Race, 
                   y=min(Count), 
                   yend=max(Count)), 
               linetype="dashed", 
               size=0.1) +   
  labs(title="Distribution of People by Ethnicity") +  
  coord_flip() + theme_classic()



data %>%
  select(Age_category, English, PWGTP) %>%
  group_by(Age_category, English) %>%
  
  summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(x=Age_category, y=Count, fill=English)) + geom_bar(stat = "identity", width=0.7, position = "dodge") + labs(title="English Fluency", x="Age Group", y = "Count") + theme_classic() + coord_flip()



kable(data %>%
        group_by(Class_of_Worker) %>%
        summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
        na.omit() %>%
        arrange(desc(Count)))  %>%
  kable_classic_2()


data %>%
  group_by(Transportation) %>%
  summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(Transportation, Count, fill=Transportation, color=Transportation)) + geom_count(show.legend = F) + 
  labs(y="Count") + theme(axis.text.x = element_blank(),
                          axis.ticks.x = element_blank()) + coord_flip() + theme_classic()


kable(data %>%
        group_by(Education) %>%
        summarise(Count = sum(PWGTP, na.rm = TRUE)) %>%
        na.omit() %>%
        arrange(desc(Count)))  %>%
  kable_classic_2()



data %>%
  count(State, sort = TRUE, weight = sum(PWGTP)) %>%
  mutate(State = reorder(State,n)) %>%
  na.omit() %>%
  ggplot(aes(x = State,y = n, fill=State)) +
  geom_col(show.legend = F) +
  coord_flip() +
  labs(x = "State",
       y = "Count",
       title = "The Distributions of Peopl by State")


#Findings

kable(data %>%
        group_by(Education) %>%
        summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
        arrange(desc(Average.Income))%>%
        top_n(5)) %>%
  kable_classic_2()

ed.anova <- aov(Income~Education, data = data, weights = PWGTP)
summary(ed.anova)

model <- lm(Income~Education, data = data, weights = PWGTP)
summary(model)

data %>%
  ggplot(aes(x=Income, color=Sex, fill=Sex, weights = sum(PWGTP))) +
  geom_histogram() + labs(title="Income Distribution",x="Income", y = "Count")

wtd.t.test(x=data$Income[data$Sex=="Male"],y=data$Income[data$Sex=="Female"], weight = data$PWGTP[data$Sex=="Male"], weighty = data$PWGTP[data$Sex=="Female"])

data %>%
  group_by(English, Sex) %>%
  filter(English != "NA") %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(English, Average.Income, fill = Sex)) + geom_bar(stat="identity", position = "dodge")+scale_fill_brewer(palette="Paired") + theme_minimal() + labs(title="Income Distribution",x="Income", y = "Count")


kable(data %>%
        group_by(Transportation) %>%
        summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE),
                  count = sum(PWGTP)) %>%
        mutate(Transportation = reorder(Transportation, Average.Income)) %>%
        arrange(desc(Average.Income))) %>% kable_classic_2()

kable(data %>%
        group_by(Race) %>%
        summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
        mutate(Race = reorder(Race, Average.Income)) %>%
        arrange(desc(Average.Income)) %>%
        top_n(10)) %>% kable_classic_2()

data %>%
  group_by(Race,Sex) %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(x=Race, y=Average.Income, fill = Sex)) + geom_col() + theme(axis.text.x = element_blank(),axis.ticks.x = element_blank()) + labs(title="Average Income of All Races",x="Race", y = "Average Income") 



kable(data %>%
        group_by(Class_of_Worker) %>%
        summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE),
                  count = sum(PWGTP)) %>%
        mutate(Class_of_Worker = reorder(Class_of_Worker, Average.Income)) %>%
        arrange(desc(Average.Income))) %>% kable_classic_2()

cl_anova <- aov(Income~Class_of_Worker, data = data, weights = PWGTP)
summary(cl_anova)

data %>%
  group_by(Marital_Status, Sex) %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(Marital_Status, Average.Income, fill = Sex)) + geom_bar(stat="identity", position = "dodge")+scale_fill_brewer(palette="Greens") + theme_minimal() + coord_flip() + labs(title="Average Income by Marital Status",x="Marital Status", y = "Average Income")



citlabs <- c("U.S.Born", "Born in Puerto Rico ..", "Born abroad of American parent(s)", "U.S. citizen by naturalization", "Not U.S citizen")


data %>%
  group_by(Citizenship, Sex) %>%
  summarise(Average.Income = weighted.mean(Income, PWGTP, na.rm = TRUE)) %>%
  ggplot(aes(Citizenship, Average.Income, fill = Sex)) + geom_bar(stat="identity", position = "dodge")+scale_fill_brewer(palette="Reds") + theme_minimal() + scale_x_discrete(labels= citlabs) + coord_flip() + labs(title="Average Income by Citizenship",x="Citizenship", y = "Average Income")



model.m <- lm(Income~Education + Class_of_Worker + Sex + Marital_Status, data = data, weights = PWGTP)
summary(model.m)

```
